接下来我负责实现鉴权模块，鉴权模块采用了非对称加密算法，可以分为两个部分，一是对用户过来的请求进行校验，二是对网关发送的请求颁发签名。这个模块使用了Alipay 的 SDK 进行签名的颁发和验证，具体实现方式是利用 gin 框架的 middleware 实现 AOP 处理。
在使用 Alipay SDK 的时候，发现颁发签名的函数在调用 httpDo 方法时将查询参数赋值为空字符串，这就导致为了适应 RESTFUL 风格，我们必须将 URI 作为 path 参数的值进行签名的颁发。可当时在验证签名的时候，我们默认使用的是 URL 作为 path 参数的值。为了解决这一冲突，我们将校验签名时的 URL 替换为 URI，保证了加密和校验时参数的对称性。
然后我就开始网关的透传功能，因为我们将（例如）支付请求转发给支付宝后，支付宝会在若干时间后发起回调，告诉我们支付结果，所以网关在进行透传的时候需要将回调地址替换为网关的回调地址，并由 notify handler 来统一处理回调请求。需要注意的是，虽然实际上存在网关这个角色，但网关对于商家和支付宝来说应该是透明的，也就是说，我们的网关需要原封不动的将响应发送回去，不能进行修改。
在实现透传的时候， mfg 发现了我写的一个 bug：在转发请求之后才将请求落库。如果支付宝回调的足够快，那么 notify handler 在处理回调请求的时候就无法在数据库中找到对应的requestId，导致误判为无效请求。


有意思的东西
● 如果原文长度不是 3 的倍数，那么进行 base64 编码时就会用=进行补充
● 注意公/私钥是否有多余的空格（真无语了这）
●  URL 和 URI 的区别
● key 版本号可以让更新操作在集群模式下平滑过度
● CID 数据域
○ 不同的 requestId 增加类型前缀，确保唯一标识
● 可控的数据模型和不可控的数据模型在 Id 字段处理方式不同
● 包装 gin.ResponseWriter 获取响应体
● 通过工厂模式（感觉像是）返回回调请求中的 requestId
● ddl 语句格式要优雅些
● 提取公钥命令

疑惑
● 网关的作用（目的）是为了解决什么问题？
○ 代码复用
○ 封装额外操作（？

待办
[ ] 校验商家公钥的 status
[ ] 测试 notify
[ ] 还有好多透传接口
[ ] 完善日志系统  --->  用自己项目中封装好的日志工具（？
